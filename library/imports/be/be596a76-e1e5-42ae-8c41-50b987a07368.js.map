{"version":3,"sources":["assets\\Script\\GameMgr.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,wEAAwE;AACxE,mBAAmB;AACnB,kFAAkF;AAClF,8BAA8B;AAC9B,kFAAkF;;;;;;;;;;;;;;;;;;;;;AAE5E,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAE1C,mCAA8B;AAE9B;IAAqC,2BAAY;IAAjD;QAAA,qEAiKC;QA/JG,WAAK,GAAS,IAAI,CAAC;QAEnB,aAAO,GAAS,IAAI,CAAC;QAErB,YAAM,GAAW,IAAI,CAAC;QAEtB,SAAG,GAAS,IAAI,CAAC;QAEjB,UAAI,GAAS,IAAI,CAAC;QAElB,WAAK,GAAY,IAAI,CAAC;QAEtB,YAAM,GAAU,IAAI,CAAC;QAErB,cAAQ,GAAS,IAAI,CAAC;QAEtB,SAAG,GAAiB,IAAI,CAAC;QAEzB,gBAAU,GAAiB,IAAI,CAAC;QAChC,wBAAwB;QACjB,WAAK,GAAS,KAAK,CAAC;QACpB,WAAK,GAAS,KAAK,CAAC;QACnB,WAAK,GAAS,KAAK,CAAC;QAGpB,WAAK,GAAS,KAAK,CAAC;;IAsIhC,CAAC;IArIG,wBAAM,GAAN;QACI,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,OAAO,GAAG,IAAI,CAAC;QAC/C,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,CAAC,OAAO,GAAG,EAAE,CAAC,EAAE,CAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;QAC1D,IAAI,CAAC,SAAS,GAAC,GAAG,CAAC;QACnB,IAAI,CAAC,QAAQ,CAAC;YACV,IAAI,CAAC,SAAS,EAAE,CAAC;QACrB,CAAC,EAAC,CAAC,CAAC,CAAA;IACR,CAAC;IAED,uBAAK,GAAL;QAAA,iBAuBC;QAtBG,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAC,IAAI,CAAC,CAAC;QACxC,IAAI,GAAG,GAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACrD,IAAI,IAAI,GAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAChB,IAAI,GAAG,GAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,UAAU,GAAC,IAAI,CAAC,CAAC;QACjD,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,UAAC,QAAQ;YAC5B,IAAI,KAAK,GAAC,CAAC,CAAC;YACZ,IAAI,IAAI,GAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC;YAC9B,OAAM,IAAI,IAAE,CAAC,EAAC;gBACV,KAAK,EAAE,CAAC;gBACR,IAAI,IAAE,EAAE,CAAC;gBACT,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;aACrB;YACD,IAAI,GAAG,GAAC,EAAE,CAAC;YACX,KAAK,GAAC,CAAC,GAAC,KAAK,CAAC;YACd,OAAM,KAAK,EAAE,EAAC;gBACV,GAAG,IAAE,GAAG,CAAA;aACX;YACD,KAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;YAC1E,KAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAC,GAAG,GAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YAC7E,KAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;YACvE,KAAI,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9E,CAAC,CAAC,CAAA;IACN,CAAC;IAED,wBAAM,GAAN,UAAQ,EAAE;QACN,IAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAE,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAE,IAAI,EAAC;YACjD,IAAI,CAAC,MAAM,CAAC,CAAC,GAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;YACjC,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,GAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,GAAC,EAAE,CAAC;SACxD;QACD,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAG,IAAI,CAAC,KAAK,EAAC;YACV,IAAI,CAAC,KAAK,GAAC,KAAK,CAAC;YACjB,IAAI,GAAG,GAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACrD,IAAI,IAAI,GAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAChB,IAAI,GAAG,GAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,UAAU,GAAC,IAAI,GAAC,OAAO,CAAC,CAAC;YACzD,IAAI,QAAQ,GAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC;YAChE,IAAG,QAAQ,IAAE,CAAC;gBAAC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;YAC7C,IAAG,QAAQ,GAAC,CAAC;gBAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,GAAC,CAAC,CAAC,CAAC;YAClC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAO,GAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC;SAC9E;aACI,IAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAE,CAAC,GAAG,EAAC;YAC7B,IAAI,CAAC,KAAK,GAAC,KAAK,CAAC;YACjB,IAAI,CAAC,IAAI,EAAE,CAAC;SACf;aAAK,IAAG,IAAI,CAAC,SAAS,IAAE,CAAC,EAAC;YACvB,IAAI,CAAC,KAAK,GAAC,KAAK,CAAC;YACjB,IAAI,CAAC,IAAI,EAAE,CAAC;SACf;IACL,CAAC;IACD,6BAAW,GAAX;QACI,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC;IACvE,CAAC;IACD,6BAAW,GAAX,UAAY,KAAY;QACpB,KAAK,IAAE,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC;QACxD,IAAI,GAAG,GAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACrD,IAAI,IAAI,GAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAChB,IAAI,GAAG,GAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,UAAU,GAAC,IAAI,GAAC,QAAQ,CAAC,CAAC;QAC1D,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACf,IAAI,KAAK,GAAC,CAAC,CAAC;QACZ,IAAI,IAAI,GAAC,KAAK,CAAC;QACf,OAAM,IAAI,IAAE,CAAC,EAAC;YACV,KAAK,EAAE,CAAC;YACR,IAAI,IAAE,EAAE,CAAC;YACT,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;SACrB;QACD,IAAI,GAAG,GAAC,EAAE,CAAC;QACX,KAAK,GAAC,CAAC,GAAC,KAAK,CAAC;QACd,OAAM,KAAK,EAAE,EAAC;YACV,GAAG,IAAE,GAAG,CAAA;SACX;QACD,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAC,GAAG,GAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;IAClE,CAAC;IACD,4BAAU,GAAV;QACI,IAAI,IAAI,GAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,GAAC,CAAC,CAAC;QAC3D,IAAI,GAAG,GAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACrD,IAAI,IAAI,GAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAChB,IAAI,GAAG,GAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,UAAU,GAAC,IAAI,GAAC,OAAO,CAAC,CAAC;QACzD,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACd,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;IAC5D,CAAC;IACD,sBAAI,GAAJ;QACI,IAAI,CAAC,YAAY,CAAC;YACd,IAAI,CAAC,KAAK,GAAC,KAAK,CAAC;QACrB,CAAC,EAAC,CAAC,CAAC,CAAC;QACL,IAAG,IAAI,CAAC,KAAK,EAAC;YACV,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;SACzB;aAAI;YACD,IAAI,CAAC,KAAK,GAAC,IAAI,CAAC;YAChB,IAAI,CAAC,KAAK,GAAC,IAAI,CAAC;YAChB,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YACtB,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAA;SAC9C;IACL,CAAC;IACD,sBAAI,GAAJ;QACI,IAAG,IAAI,CAAC,KAAK,EAAC;YACV,IAAI,CAAC,KAAK,GAAC,IAAI,CAAC;YAChB,IAAI,CAAC,KAAK,GAAC,KAAK,CAAC;YACjB,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC;YAC1C,IAAI,CAAC,YAAY,CAAC;gBACd,IAAI,CAAC,KAAK,GAAC,KAAK,CAAC;YACrB,CAAC,EAAC,CAAC,CAAC,CAAC;SACR;aAAK,IAAG,CAAC,IAAI,CAAC,KAAK,EAAC;YACjB,IAAI,CAAC,KAAK,GAAC,IAAI,CAAC;YAChB,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;YACzC,IAAI,CAAC,YAAY,CAAC;gBACd,IAAI,CAAC,KAAK,GAAC,KAAK,CAAC;gBACjB,IAAI,CAAC,KAAK,GAAC,IAAI,CAAC;gBAChB,IAAI,CAAC,KAAK,GAAC,KAAK,CAAC;YACrB,CAAC,EAAC,CAAC,CAAC,CAAC;SACR;IACL,CAAC;IACD,qBAAG,GAAH;QACI,EAAE,CAAC,WAAW,CAAC,UAAU,EAAE,CAAC;QAC5B,EAAE,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,EAAC,KAAK,CAAC,CAAC;QACjD,IAAI,GAAG,GAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACrD,IAAI,IAAI,GAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAChB,IAAI,GAAG,GAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,UAAU,GAAC,IAAI,GAAC,QAAQ,GAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC;QACtG,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACd,IAAI,CAAC,YAAY,CAAC;YACd,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAClC,CAAC,EAAC,CAAC,CAAC,CAAC;QACL,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC;IAC7C,CAAC;IA7JD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;0CACC;IAEnB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;4CACG;IAErB;QADC,QAAQ,CAAC,gBAAM,CAAC;2CACK;IAEtB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;wCACD;IAEjB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;yCACA;IAElB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;0CACI;IAEtB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;2CACG;IAErB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;6CACI;IAEtB;QADC,QAAQ,CAAC,EAAC,IAAI,EAAC,EAAE,CAAC,SAAS,EAAC,CAAC;wCACL;IAEzB;QADC,QAAQ,CAAC,EAAC,IAAI,EAAC,EAAE,CAAC,SAAS,EAAC,CAAC;+CACE;IApBf,OAAO;QAD3B,OAAO;OACa,OAAO,CAiK3B;IAAD,cAAC;CAjKD,AAiKC,CAjKoC,EAAE,CAAC,SAAS,GAiKhD;kBAjKoB,OAAO","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\ndeclare const firebase: any;\r\nimport Player from \"./Player\";\r\n@ccclass\r\nexport default class GameMgr extends cc.Component {\r\n    @property(cc.Node)\r\n    timer:cc.Node=null;\r\n    @property(cc.Node)\r\n    lifeNum:cc.Node=null;\r\n    @property(Player)\r\n    player: Player = null;\r\n    @property(cc.Node)\r\n    map:cc.Node=null;\r\n    @property(cc.Node)\r\n    coin:cc.Node=null;\r\n    @property(cc.Node)\r\n    score: cc.Node = null;\r\n    @property(cc.Node)\r\n    camera: cc.Node=null;\r\n    @property(cc.Node)\r\n    worldNum:cc.Node=null;\r\n    @property({type:cc.AudioClip})\r\n    bgm: cc.AudioClip = null;\r\n    @property({type:cc.AudioClip})\r\n    levelClear: cc.AudioClip = null;\r\n    // LIFE-CYCLE CALLBACKS:\r\n    public pause:boolean=false;\r\n    public reset:boolean=false;\r\n    private grown:boolean=false;\r\n    private countDown:number;\r\n    \r\n    private dying:boolean=false;\r\n    onLoad () {\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        cc.director.getPhysicsManager().gravity = cc.v2 (0, -200);\r\n        this.countDown=300;\r\n        this.schedule(function(){\r\n            this.countDown--;\r\n        },1)\r\n    }\r\n\r\n    start () {\r\n        cc.audioEngine.playMusic(this.bgm,true);\r\n        var tmp=firebase.auth().currentUser.email.split('@');\r\n        var user=tmp[0];\r\n        var ref=firebase.database().ref('prevent/'+user);\r\n        ref.once('value').then((snapshot)=>{\r\n            var count=0;\r\n            var temp=snapshot.val().score;\r\n            while(temp>=1){\r\n                count++;\r\n                temp/=10;\r\n                console.log(temp);\r\n            }\r\n            var pre='';\r\n            count=7-count;\r\n            while(count--){\r\n                pre+='0'\r\n            }\r\n            this.worldNum.getComponent(cc.Label).string=snapshot.val().now.toString();\r\n            this.score.getComponent(cc.Label).string=pre+snapshot.val().score.toString();\r\n            this.coin.getComponent(cc.Label).string=snapshot.val().coin.toString();\r\n            this.lifeNum.getComponent(cc.Label).string=snapshot.val().life.toString();\r\n        })\r\n    }\r\n\r\n    update (dt) {\r\n        if(this.player.node.x>=0 && this.player.node.x<=4041){\r\n            this.camera.x=this.player.node.x;\r\n            cc.find('Canvas/background').x=this.player.node.x+48;\r\n        }\r\n        this.updateTimer();\r\n        if(this.reset){\r\n            this.reset=false;\r\n            var tmp=firebase.auth().currentUser.email.split('@');\r\n            var user=tmp[0];\r\n            var ref=firebase.database().ref('prevent/'+user+'/life');\r\n            var now_life=Number(this.lifeNum.getComponent(cc.Label).string);\r\n            if(now_life==0)cc.director.loadScene('lose');\r\n            if(now_life>0)ref.set(now_life-1);\r\n            cc.director.loadScene('stage'+this.worldNum.getComponent(cc.Label).string);\r\n        }\r\n        else if(this.player.node.y<=-274){\r\n            this.grown=false;\r\n            this.hurt();\r\n        }else if(this.countDown<=0){\r\n            this.grown=false;\r\n            this.hurt();\r\n        }\r\n    }\r\n    updateTimer(){\r\n        this.timer.getComponent(cc.Label).string=this.countDown.toString();\r\n    }\r\n    updateScore(score:number){\r\n        score+=Number(this.score.getComponent(cc.Label).string);\r\n        var tmp=firebase.auth().currentUser.email.split('@');\r\n        var user=tmp[0];\r\n        var ref=firebase.database().ref('prevent/'+user+'/score');\r\n        ref.set(score);\r\n        var count=0;\r\n        var temp=score;\r\n        while(temp>=1){\r\n            count++;\r\n            temp/=10;\r\n            console.log(temp);\r\n        }\r\n        var pre='';\r\n        count=7-count;\r\n        while(count--){\r\n            pre+='0'\r\n        }\r\n        this.score.getComponent(cc.Label).string=pre+score.toString();\r\n    }\r\n    updateCoin(){\r\n        var coin=Number(this.coin.getComponent(cc.Label).string)+1;\r\n        var tmp=firebase.auth().currentUser.email.split('@');\r\n        var user=tmp[0];\r\n        var ref=firebase.database().ref('prevent/'+user+'/coin');\r\n        ref.set(coin);\r\n        this.coin.getComponent(cc.Label).string=coin.toString();\r\n    }\r\n    grow(){\r\n        this.scheduleOnce(function(){\r\n            this.pause=false;\r\n        },1);\r\n        if(this.grown){\r\n            this.updateScore(100);\r\n        }else{\r\n            this.pause=true;\r\n            this.grown=true;\r\n            this.updateScore(100);\r\n            this.player.getComponent('Player').growUp()\r\n        }\r\n    }\r\n    hurt(){\r\n        if(this.grown){\r\n            this.pause=true;\r\n            this.grown=false;\r\n            this.player.getComponent('Player').hurt();\r\n            this.scheduleOnce(function(){\r\n                this.pause=false;\r\n            },1);\r\n        }else if(!this.dying){\r\n            this.dying=true;\r\n            this.player.getComponent('Player').die();\r\n            this.scheduleOnce(function(){\r\n                this.pause=false;\r\n                this.reset=true;\r\n                this.dying=false;\r\n            },4);\r\n        }\r\n    }\r\n    Win(){\r\n        cc.audioEngine.pauseMusic();\r\n        cc.audioEngine.playEffect(this.levelClear,false);\r\n        var tmp=firebase.auth().currentUser.email.split('@');\r\n        var user=tmp[0];\r\n        var ref=firebase.database().ref('prevent/'+user+'/stage'+this.worldNum.getComponent(cc.Label).string);\r\n        ref.set(true);\r\n        this.scheduleOnce(function(){\r\n            cc.director.loadScene('menu');\r\n        },4);\r\n        this.player.getComponent('Player').Win();\r\n    }\r\n\r\n}\r\n"]}